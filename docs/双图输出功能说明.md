# 双图输出功能使用说明

## 功能概述

`fibonacci_cli_visualizer.py` 现在支持**同时生成两张可视化图表**：

### 图1：正常尺寸图
- **尺寸**：14英寸 × 7英寸
- **DPI**：150
- **布局**：左侧网格（占75%），右侧图例（占25%）
- **用途**：快速预览和一般用途
- **文件名格式**：`fibonacci_mod_{模数}_visualization.png`

### 图2：高分辨率大图
- **动态尺寸**：根据网格大小自动计算
- **DPI**：300（高清）
- **最小格子尺寸**：确保每个格子至少10×10像素
- **网格线**：添加细网格线，确保每个格子清晰可见
- **布局**：左侧网格（占85%），右侧图例（占15%）
- **用途**：详细分析、打印、高质量展示
- **文件名格式**：`fibonacci_mod_{模数}_highres.png`

## 快速开始

### 1. 运行程序

```bash
python3.13 fibonacci_cli_visualizer.py
```

### 2. 计算模数

```
主菜单:
1. 计算新的模数
2. 选择要可视化的数列
3. 生成可视化图表
...

请选择 (0-5): 1
请输入模数 (1-1000000): 50
```

### 3. 选择数列

```
请选择 (0-5): 2

选择要可视化的数列:
  - 输入范围，如: 3-5,6,7-21
  - 输入 'all' 选择所有数列
  - 输入 'clear' 清空选择
  - 输入 'done' 完成选择
  - 输入 'back' 返回主菜单

请输入: all
```

### 4. 生成图表

```
请选择 (0-5): 3

正在生成可视化图表...
  - 模数: 50
  - 选择的数列数: 16

生成图1: 正常尺寸...
生成图2: 高分辨率大图...
  - 图形尺寸: 20.0x20.0 英寸
  - 分辨率: 6000x6000 像素

✓ 图表生成完成！
  - 关闭图表窗口以返回菜单

是否保存图表为PNG文件? (y/n): y
✓ 图1已保存为: fibonacci_mod_50_visualization.png
✓ 图2（高分辨率）已保存为: fibonacci_mod_50_highres.png
  - 尺寸: 20.0x20.0 英寸
  - DPI: 300
  - 像素: 6000x6000
```

## 文件说明

生成的文件包括：

1. **正常尺寸图**：适合快速查看和分享
   - 文件较小（通常几十KB到几百KB）
   - 加载速度快
   - 适合网页展示

2. **高分辨率大图**：适合详细分析和打印
   - 文件较大（通常几百KB到几MB）
   - 每个格子清晰可见
   - 适合打印、演示和深入分析

## 性能参考

### 不同模数的生成时间

| 模数 | 网格尺寸 | 正常图 | 高清图 | 总时间 |
|------|----------|--------|--------|--------|
| 10   | 10×10    | 1秒    | 2秒    | 3秒    |
| 50   | 50×50    | 2秒    | 5秒    | 7秒    |
| 100  | 100×100  | 3秒    | 10秒   | 13秒   |
| 200  | 200×200  | 5秒    | 30秒   | 35秒   |
| 500  | 500×500  | 10秒   | 2分钟  | 2.5分钟|

### 内存使用参考

| 模数 | 高清图内存占用 | 建议可用内存 |
|------|----------------|--------------|
| < 100 | < 500MB        | 2GB          |
| 100-200 | 500MB-2GB     | 4GB          |
| 200-500 | 2GB-10GB      | 16GB         |
| > 500 | > 10GB         | 32GB+        |

## 大模数警告

当模数大于200时，程序会显示警告：

```
生成图2: 高分辨率大图...
  ⚠️  警告: 模数 300 较大，生成高分辨率图可能:
     - 消耗大量内存 (预计 > 2GB)
     - 需要较长时间 (可能 > 30秒)
     - 生成大文件 (可能 > 10MB)

  是否继续生成? (y/n):
```

## 技术细节

### 尺寸计算公式

```python
min_pixel_per_cell = 10  # 每个格子最小10像素
dpi = 300  # 高清分辨率
fig_width = max(20, grid_size * min_pixel_per_cell / dpi * 1.2)
fig_height = fig_width  # 保持正方形
```

### 网格线设置

```python
ax_grid2.set_xticks(np.arange(-0.5, grid_size, 1), minor=True)
ax_grid2.set_yticks(np.arange(-0.5, grid_size, 1), minor=True)
ax_grid2.grid(which='minor', color='gray', linestyle='-', linewidth=0.5, alpha=0.3)
```

### 智能坐标标签

- **小网格**（≤50）：显示所有坐标
- **大网格**（>50）：每N个格子显示一个标签，避免过于密集

```python
if grid_size <= 50:
    step = 1  # 显示所有
else:
    step = max(1, grid_size // 20)  # 每20个显示一个
```

## 注意事项

1. **字体警告**：如果看到中文字符的字体警告，不影响图片生成，可以忽略

2. **内存不足**：如果生成高清图时内存不足，可以：
   - 降低DPI值（修改代码中的dpi变量）
   - 减小min_pixel_per_cell值
   - 只生成正常尺寸图

3. **显示问题**：如果在某些环境下图表窗口无法显示：
   - 程序会自动跳过显示，继续执行保存操作
   - 可以直接回答'n'跳过显示，只保存文件

4. **文件大小**：高清图可能很大，确保有足够的磁盘空间

## 故障排除

### 问题：图表窗口无法关闭

**解决**：直接关闭终端或按 Ctrl+C 强制退出

### 问题：内存不足

**解决**：
- 对于模数 > 200，选择 'n' 不生成高清图
- 或修改代码降低分辨率

### 问题：生成时间太长

**解决**：
- 这是正常的，高分辨率需要更多计算时间
- 对于大模数，可以只选择部分数列进行可视化

### 问题：中文字符显示为方框

**解决**：
- 这是字体问题，不影响图片保存
- 如需修复，请安装中文字体并配置matplotlib

## 示例

### 示例1：小模数快速测试

```bash
# 运行程序
python3.13 fibonacci_cli_visualizer.py

# 菜单选择:
# 1. 输入模数: 20
# 2. 选择数列: all
# 3. 生成图表
# 4. 保存: y

# 输出:
# - fibonacci_mod_20_visualization.png (约 40KB)
# - fibonacci_mod_20_highres.png (约 200KB)
```

### 示例2：中等模数分析

```bash
# 菜单选择:
# 1. 输入模数: 100
# 2. 选择数列: 0-10,15,20-25  # 选择部分数列
# 3. 生成图表
# 4. 保存: y

# 输出:
# - fibonacci_mod_100_visualization.png (约 100KB)
# - fibonacci_mod_100_highres.png (约 1MB)
```

### 示例3：大模数（谨慎使用）

```bash
# 菜单选择:
# 1. 输入模数: 500
# 2. 选择数列: all
# 3. 生成图表
#   - 会看到内存警告
#   - 确认: n  (如果不想生成高清图)
#   - 或确认: y (如果有足够内存)
```

## 更新日志

### 2025-12-30
- ✓ 实现双图输出功能
- ✓ 添加高分辨率大图生成
- ✓ 添加内存警告提示
- ✓ 优化显示和保存逻辑
- ✓ 添加错误处理和内存清理

## 联系与支持

如有问题或建议，欢迎反馈！
