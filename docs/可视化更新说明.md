# 可视化程序更新说明

## 更新内容

已成功修改 `fibonacci_cli_visualizer.py`，现在每次生成可视化时会创建**两张图**：

### 图1：正常尺寸图
- **尺寸**：14英寸 × 7英寸
- **DPI**：150
- **布局**：左侧网格（占3/4），右侧图例（占1/4）
- **用途**：快速预览和一般用途

### 图2：高分辨率大图
- **动态尺寸**：根据网格大小自动计算
- **DPI**：300（高清）
- **最小格子尺寸**：确保每个格子至少10×10像素
- **网格线**：添加细网格线，确保每个格子清晰可见
- **布局**：左侧网格（占85%），右侧图例（占15%）
- **用途**：详细分析、打印、展示

## 技术细节

### 自适应尺寸计算

高分辨率图的尺寸计算公式：
```python
min_pixel_per_cell = 10  # 每个格子最小10像素
dpi = 300  # 高清分辨率
fig_width = max(20, grid_size * min_pixel_per_cell / dpi * 1.2)
fig_height = fig_width  # 保持正方形
```

**示例**：
- 如果模数=50，网格=50×50
- 图形尺寸 ≈ 20×20英寸
- 像素 = 6000×6000像素
- 每个格子 = 120×120像素

### 网格线

大图添加了细网格线：
```python
ax_grid2.set_xticks(np.arange(-0.5, grid_size, 1), minor=True)
ax_grid2.set_yticks(np.arange(-0.5, grid_size, 1), minor=True)
ax_grid2.grid(which='minor', color='gray', linestyle='-', linewidth=0.5, alpha=0.3)
```

### 智能坐标标签

- **小网格**（≤50）：显示所有坐标
- **大网格**（>50）：每N个格子显示一个标签，避免过于密集

```python
if grid_size <= 50:
    step = 1  # 显示所有
else:
    step = max(1, grid_size // 20)  # 每20个显示一个
```

## 使用说明

### 安装依赖

```bash
pip3 install matplotlib numpy
```

### 运行程序

```bash
python3 fibonacci_cli_visualizer.py
```

### 操作步骤

1. **计算模数**
   - 选择菜单：1. 计算新的模数
   - 输入：100（或其他数值）

2. **选择数列**
   - 选择菜单：2. 选择要可视化的数列
   - 输入：all（或特定范围，如：3-5,7-9）

3. **生成图表**
   - 选择菜单：3. 生成可视化图表
   - 程序会同时生成两张图

4. **保存图片**
   - 提示：是否保存图表为PNG文件?
   - 输入：y
   - 保存文件：
     - `fibonacci_mod_XXX_visualization.png`（正常版）
     - `fibonacci_mod_XXX_highres.png`（高清版）

## 输出文件说明

### 文件名格式

- **正常版**：`fibonacci_mod_{模数}_visualization.png`
- **高清版**：`fibonacci_mod_{模数}_highres.png`

### 文件信息

程序会显示高清版的详细信息：
```
✓ 图2（高分辨率）已保存为: fibonacci_mod_100_highres.png
  - 尺寸: 20.0x20.0 英寸
  - DPI: 300
  - 像素: 6000x6000
```

## 性能考虑

### 内存使用

高分辨率图可能占用大量内存：

| 模数 | 网格尺寸 | 图形尺寸 | 像素 | 估计内存 |
|------|----------|----------|------|----------|
| 50   | 50×50    | 20×20英寸| 6000×6000 | ~200MB |
| 100  | 100×100  | 33×33英寸| 10000×10000| ~600MB |
| 200  | 200×200  | 66×66英寸| 20000×20000| ~2.4GB |

**建议**：
- 模数<100：安全生成高清图
- 模数100-200：确保有足够内存（>4GB）
- 模数>200：谨慎使用，可能消耗大量内存

### 生成时间

高清图生成时间取决于：
- 网格大小（模数）
- 选择的数列数量
- 计算机性能

大致参考：
- 模数50：2-5秒
- 模数100：5-10秒
- 模数200：15-30秒

## 示例展示

### 小模数示例（模=10）

```bash
# 计算
./fibonacci_mod 10

# 可视化（选择所有数列）
python3 fibonacci_cli_visualizer.py
# 菜单1 → 输入10
# 菜单2 → 输入all
# 菜单3 → 生成图表

# 输出文件：
# - fibonacci_mod_10_visualization.png (14×7英寸, 150DPI)
# - fibonacci_mod_10_highres.png (20×20英寸, 300DPI)
```

### 中等模数示例（模=50）

```bash
# 计算（可能需要几分钟）
./fibonacci_mod 50

# 可视化
python3 fibonacci_cli_visualizer.py
# 菜单1 → 输入50
# 菜单2 → 输入all
# 菜单3 → 生成图表

# 输出文件：
# - fibonacci_mod_50_visualization.png
# - fibonacci_mod_50_highres.png (约20×20英寸, 6000×6000像素)
```

## 代码修改位置

主要修改了 `fibonacci_cli_visualizer.py` 中的 `generate_visualization` 方法：

1. **保持原有网格数据生成逻辑**（不变）
2. **图1**：使用原有代码，生成正常尺寸图
3. **新增图2**：
   - 动态计算图形尺寸
   - 设置高DPI（300）
   - 添加网格线
   - 优化坐标标签显示
   - 调整图例字体大小
4. **保存**：同时保存两个文件

## 注意事项

1. **matplotlib版本**：建议使用3.0+
2. **内存**：生成大图时确保有足够内存
3. **显示**：高清图可能超出屏幕，需要缩放查看
4. **导出**：高清图文件较大，注意磁盘空间

## 常见问题

### Q: 为什么生成两张图？
A: 一张用于快速预览，一张用于详细分析和高质量输出。

### Q: 高清图太大，如何调整？
A: 可以修改 `min_pixel_per_cell` 变量（默认为10），减小为5或8。

### Q: 能否只生成高清图？
A: 可以注释掉图1的相关代码，只保留图2。

### Q: 高清图生成很慢？
A: 这是正常的，高分辨率需要更多计算时间。可以降低DPI到200。

## 后续优化建议

1. 添加进度条显示高清图生成进度
2. 支持只生成指定格式的图
3. 添加更多的网格线样式选项
4. 支持导出为PDF矢量格式
5. 添加内存使用警告

---

**修改完成时间**：2025-12-30
**修改文件**：`fibonacci_cli_visualizer.py`
**主要功能**：双图输出（正常版+高清版）
